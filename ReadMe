ğŸ§  Why do all requests log â€œReservedâ€, but only some succeed?

This project intentionally demonstrates a race condition and its fix using Optimistic Locking.

The confusing part

You may notice logs like:

Reserved 1 unit of product P3
Reserved 1 unit of product P3
Reserved 1 unit of product P3


â€¦but in reality, only 1 or 2 orders actually succeed.

This looks wrong â€” but itâ€™s expected behavior.

ğŸš¨ Important concept (in simple words)

Inside a @Transactional method:

save() does NOT immediately update the database

Instead:

Hibernate updates the object in memory

Marks it as â€œchangedâ€

Delays the real database update

So:

inventoryRepository.save(inventory);


means:

â€œIâ€™ll update this later when the transaction finishesâ€

â€”not â€œupdate DB right nowâ€.





===================================================
ğŸ“Œ14-2-26
 Circular Dependency Error â€“ Short Notes
ğŸ”¹ What Is Circular Dependency?

When two Spring beans depend on each other.

Example:

InventoryService â†’ InventoryTransactionService
InventoryTransactionService â†’ InventoryService


This creates a loop.

Spring cannot decide which one to create first.

ğŸ”¹ Why Spring Fails to Start?

Spring creates beans at startup.

If:

Bean A needs Bean B
Bean B needs Bean A


Spring gets stuck in infinite creation loop.

So modern Spring Boot blocks it by default.

Error:

Relying upon circular references is discouraged

ğŸ”¹ Why It Happened In Our Case?

We injected:

@Autowired
private InventoryTransactionService transactionService;


inside InventoryService

AND

@Autowired
private InventoryService inventoryService;


inside InventoryTransactionService

That created:

Service A â†” Service B

ğŸ”¹ How To Fix It?

âœ” Remove one dependency
âœ” Only one direction allowed

Correct structure:

Controller
   â†“
InventoryService (retry logic)
   â†“
InventoryTransactionService (@Transactional)
   â†“
Repository


âŒ TransactionService must NOT depend on InventoryService.

ğŸ”¹ Important Rule

If A depends on B,
B must NOT depend on A.

ğŸ”¹ Bad Solution (Do NOT Use)
spring.main.allow-circular-references=true


This hides bad design.

Always fix architecture instead.